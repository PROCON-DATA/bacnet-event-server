# ============================================================================
# Redis Configuration für BACnet Gateway
# 
# Optimiert für:
# - Persistente Speicherung von BACnet Objekten
# - Schneller Zugriff für Value Updates
# - Crash Recovery
# ============================================================================

# Netzwerk
bind 0.0.0.0
port 6379
protected-mode no

# ============================================================================
# PERSISTENZ - Hybrid (RDB + AOF) für beste Datensicherheit
# ============================================================================

# RDB Snapshots
# save <seconds> <changes>
save 900 1      # Nach 15 Min wenn mindestens 1 Änderung
save 300 10     # Nach 5 Min wenn mindestens 10 Änderungen
save 60 1000    # Nach 1 Min wenn mindestens 1000 Änderungen

dbfilename dump.rdb
dir /data

# AOF (Append Only File) - Jede Operation wird geloggt
appendonly yes
appendfilename "appendonly.aof"

# fsync Policy:
# - always: Jeder Befehl wird sofort geschrieben (sicher, langsam)
# - everysec: Einmal pro Sekunde (guter Kompromiss)
# - no: OS entscheidet (schnell, unsicher)
appendfsync everysec

# AOF Rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# RDB Kompression
rdbcompression yes
rdbchecksum yes

# ============================================================================
# SPEICHER
# ============================================================================

# Maximaler Speicher (anpassen nach Bedarf)
maxmemory 256mb

# Eviction Policy wenn maxmemory erreicht
# volatile-lru: Entferne Keys mit expire, die am längsten nicht verwendet wurden
maxmemory-policy volatile-lru

# ============================================================================
# PERFORMANCE
# ============================================================================

# TCP Keepalive
tcp-keepalive 300

# Timeout für idle Connections (0 = deaktiviert)
timeout 0

# TCP Backlog
tcp-backlog 511

# Client Output Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# ============================================================================
# LOGGING
# ============================================================================

loglevel notice
logfile ""

# ============================================================================
# SICHERHEIT (für Produktion aktivieren!)
# ============================================================================

# Passwort setzen (auskommentieren und anpassen für Produktion)
# requirepass your_secure_password_here

# Gefährliche Befehle deaktivieren (für Produktion)
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command DEBUG ""
# rename-command CONFIG ""
